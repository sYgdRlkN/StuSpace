# StuSpace 演示指南（按评分点走，老师看了容易给高分）

目标：用 8~12 分钟完成演示，覆盖评分标准：
- 功能全面（增删改查）、界面美观、创新点
- ER 图、索引、范式、完整性约束
- 服务端代码：存储过程 + 触发器
- 功能运行正常，异常可处理

准备工作（演示前 2 分钟完成）

1) 启动后端

```bash
cd backend
python manage.py runserver
```

2) 启动前端

- 用 VS Code Live Server 打开登录页：[fronted/login.html](../fronted/login.html)

3)（可选）生成演示数据

```bash
cd backend
python populate_db.py
```

演示账号

- 管理员：`admin / adminpassword`
- 学生：
  - `demo_low / 123456`（信用分 55：用于演示“低分限制预约”）
  - `demo_mid / 123456`（信用分 60：边界值）
  - `demo_good / 123456`（信用分 80）

---

一、开场（30 秒）——一句话讲清系统

你说：
- “这是一个学习空间预约系统，前端静态页面 + 后端 Django JSON API + MySQL 数据库。”
- “核心闭环：查询空闲 → 预约 → 签到/签退 → 评价；管理员可做违规检测并影响用户信用分。”

你展示：
- 浏览器打开登录页，能看到 Bootstrap 风格界面（美观项）。

---

二、功能全面（CRUD + 业务闭环）（4~5 分钟）

1) 注册（Create）

怎么做：
- 在登录页切到“注册”，注册一个新用户。

你说：
- “注册是新增用户（C），用户名唯一，后端会做重复校验。”

异常演示（可选，10 秒）：
- 用同名用户名再注册一次，应提示失败。

2) 登录 + 空间列表查询（Read）

怎么做：
- 用 `demo_good / 123456` 登录，进入首页。
- 展示空间列表、剩余座位（可用容量计算）。

你说：
- “空间列表是查询（R）。剩余座位会根据当前预约/使用中的记录动态计算。”

3) 自定义时间预约（Create + 创新点）

怎么做：
- 点击某空间“预约”，弹出时间选择模态框。
- 选择开始/结束时间，确认预约。

你说：
- “支持自定义预约时间是本项目的业务创新点之一；同时会做时间段冲突校验与容量校验。”

异常演示（可选，20 秒）：
- 选一个明显错误的时间（结束早于开始）→ 应返回错误。
- 同一账号再约一个重叠时间段 → 应提示 time conflict。

4) 我的预约（Read）+ 取消预约（Update）

怎么做：
- 打开“我的预约”，能看到状态 badge 与操作按钮。
- 对一个 `reserved` 状态的预约点击“取消”。

你说：
- “取消本质是状态更新（U），避免物理删除带来的审计问题，同时释放占用容量。”

5) 签到/签退（Update）+ 使用记录（Create）

怎么做：
- 找一个即将开始的预约，在允许窗口内点“签到”。
- 再点“签退”，状态变 `completed`。

你说：
- “签到/签退是对预约状态的更新（U），同时写入/更新 usage_record（使用记录）。”

异常演示（建议做，20 秒）：
- 对不在窗口的预约点“签到” → 返回 Too early / Too late（说明异常处理到位）。

6) 评价（Create + 完整性约束展示点）

怎么做：
- 对 `completed` 的预约点击“评价”，提交 1~5 分和评论。

你说：
- “评价是新增（C）。并且数据库层保证 1 个预约最多 1 条评价。”

异常演示（可选）：
- 同一条预约重复评价，应提示失败。

---

三、管理员与创新点（违规检测 + 信用分）（2~3 分钟）

1) 管理员登录 + 概览面板

怎么做：
- 退出登录，用管理员 `admin / adminpassword` 登录。
- 展示管理端概览：空间数、总容量、活跃预约等。

你说：
- “这是管理员的统计视图，用于运营与监管。”

2) 违规检测（服务端逻辑）

怎么做：
- 点击“运行违规检测”。
- 展示返回：处理未签到数量、当前超时数量。

你说：
- “未签到会被标记为取消，并写入 abnormal_behavior，同时扣减用户信用分。”

3) 用户信用分列表（创新点）

怎么做：
- 在“用户信用管理”表里展示信用分变动。

你说：
- “信用分用于约束预约资格：低于 60 不能预约，实现‘奖惩闭环’。”

额外 10 秒演示：
- 用 `demo_low` 登录尝试预约 → 会被拒绝（展示规则生效）。

---

四、数据库高分点（ER 图 / 3NF / 索引 / 完整性 / 视图 / 过程 / 触发器）（2~3 分钟）

这一部分建议“边讲边点开文件”，让老师看到你不是口嗨。

1) ER 图 & 3NF

怎么展示：
- 打开老师版说明：[README.md](../README.md)
- 滚到 Mermaid ER 图与 3NF 小节。

你说：
- “表按 3NF 拆分：用户/空间/预约/使用记录/异常/评价分表，避免冗余与更新异常。”

2) 索引与完整性约束（schema.sql）

怎么展示：
- 打开 [docs/schema.sql](schema.sql)
- 搜索关键字：`CREATE INDEX`、`CHECK`、`UNIQUE`。

你说：
- “冲突/容量查询是热点，`idx_reservation_space_time`/`idx_reservation_user_time` 专门优化时间段重叠查询。”
- “CHECK/UNIQUE/FK 约束保证状态、时间范围、评分范围、以及一预约一评价等规则。”

3) 视图（View）

怎么展示：
- 在 [docs/schema.sql](schema.sql) 搜索 `CREATE VIEW v_space_today_stats`。

你说：
- “视图把统计逻辑固化为数据库对象，管理端报表查询更直接，减少重复 SQL。”

4) 存储过程（Stored Procedure）

怎么展示（代码）：
- 在 [docs/schema.sql](schema.sql) 搜索 `CREATE PROCEDURE sp_create_reservation`。

你说：
- “过程把信用分门槛、容量/冲突校验、并发控制（FOR UPDATE）下沉到数据库层，避免多端绕过。”

可选演示（执行 SQL，30 秒）：

```sql
USE study_space_db;
CALL sp_create_reservation(2, 1, NOW() + INTERVAL 1 HOUR, NOW() + INTERVAL 2 HOUR);
```

5) 触发器（Trigger）

怎么展示：
- 在 [docs/schema.sql](schema.sql) 搜索 `CREATE TRIGGER trg_feedback_only_completed`。

你说：
- “触发器强制只有 completed 的预约才允许插入评价，这是数据库层的硬约束，能兜底应用层遗漏。”

---

五、代码质量（30~60 秒）

怎么展示：
- 打开 [backend/space/views.py](../backend/space/views.py)
- 搜索并快速扫一遍：`reserve_space`、`check_in`、`check_out`、`check_violations`。

你说：
- “后端统一 JSON 返回结构；对参数缺失、权限不足、状态非法、时间窗口不合法等情况都有明确错误响应。”

---

收尾（10 秒）

你说：
- “系统功能闭环完整，数据库对象齐全（索引/约束/视图/过程/触发器），并且能演示异常处理与创新点（信用分与违规检测）。谢谢老师。”
